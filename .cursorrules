# Spotify Playlist Manager

Blazor Server app (.NET 9.0) for viewing and sorting Spotify playlist tracks by genre.

## Tech Stack

- Blazor Server (Interactive Server render mode)
- Tailwind CSS (dark theme)
- Google OAuth + Spotify OAuth2 (custom)
- Session-based token storage

## Architecture: Vertical Slice

```
src/UI/
├── App/                    # Shell: MainLayout, App, Routes, Error
├── Features/
│   ├── Shared/             # Shared components (Header, Sidebar)
│   └── {Feature}/          # Page.razor, Service.cs, Models.cs
├── Infrastructure/         # Technical concerns (Auth/, Spotify/, Observability/)
└── wwwroot/app.css
```

**Principles**: Feature-based organization, Infrastructure for technical concerns only (no business logic), shared UI in `Features/Shared/`.

## Code Style

- File-scoped namespaces, primary constructors, `sealed` classes
- `record` types for DTOs with `init` setters
- Collection expressions `[]`, target-typed `new()`
- Explicit types (`string x = ...` not `var`)
- Underscore prefix for private fields (`_httpClient`)
- Named parameters for clarity
- `System.Text.Json` with `[JsonPropertyName]`
- Extension methods for DI registration (e.g., `AddSpotifyServices()`)

## Blazor

- `@rendermode InteractiveServer` for interactive pages
- `@inject` at top, `@code {}` for logic
- Auth state handling in `OnInitializedAsync()`

## Tailwind Theme

- Background: `bg-[#0f1729]` (main), `bg-[#232a3b]` (cards)
- Text: `text-white`, `text-gray-200`, `text-gray-400`
- Accent: `text-green-500`, `border-green-500`
- Grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6`

## Spotify API

- Base: `https://api.spotify.com/v1/`
- Endpoints: `/me/playlists`, `/playlists/{id}`, `/playlists/{id}/tracks`, `/artists/{id}`
- Auto token refresh via `ExecuteWithTokenRefreshAsync<T>()`
- Auth endpoints: `/spotify-auth` (initiate), `/callback` (OAuth)

## Observability

OpenTelemetry configured via `AddObservability()` in `Infrastructure/Observability/`.

**Logging patterns:**
- Inject `ILogger<T>` in services
- `LogDebug` before operations, `LogInformation` after success with counts
- `LogWarning` for recoverable issues, `LogError` for failures
- Use structured logging: `_logger.LogInformation("Fetched {Count} items", items.Count)`

**Custom traces:**
```csharp
using Activity? activity = ObservabilityExtensions.StartActivity("OperationName");
activity?.SetTag("key", value);
activity?.SetStatus(ActivityStatusCode.Error, ex.Message);  // on failure
```

**Config:** Set `Observability:OtlpEndpoint` for OTLP export (Jaeger, Aspire), otherwise Console.

## Git Commits

Follow [Conventional Commits](https://www.conventionalcommits.org/): `feat`, `fix`, `build`, `chore`, `docs`, `refactor`, `perf`, `test`. Max 72 chars, imperative mood.

## Run

```bash
dotnet run --project src/UI/UI.csproj --launch-profile http
```

App runs on `http://127.0.0.1:5155`.
